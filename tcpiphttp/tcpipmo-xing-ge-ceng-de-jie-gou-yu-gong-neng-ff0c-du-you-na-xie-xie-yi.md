![](/assets/0001.png)

TCP/IP模型中没有表示层和会话层，在TCP/IP模型中，通常认为应用层是OSI模型的最高三层\(应用层、表示层和会话层\)的合并

OSI：Open System Interconnection 开放系统互联

TCP/IP：Transmission Control Protocol/Internet Protocol 传输控制协议/网际协议

## TCP/IP模型各层的结构、功能和协议

### 1 网络接口层

网络接口层即数据链路层。

TCP/IP没有为数据链路层定义任何特定的协议。

计算机之间传输的是0和1的电信号数据，但是单纯的0和1没有任何意义，所以必须规定解读方式：多少个电信号算一组，每个信号位有何意义。

以太网规定，一组电信号构成一个数据包（**以太网数据包**），叫做“帧”，每一帧分成两个部分：标头\(Head\)和数据\(Data\)。“标头”包含数据包的一些说明项，比如发送者、接收者、数据类型等等；“数据”则是数据包的具体内容。

数据链路层的作用就是确定0和1的分组方式，将0和1划分为数据帧，并从一个节点传输到临近的另一个节点，这些节点是通过MAC地址来唯一标识的。

**MAC地址**：以太网规定，连入网络的所有设备，都必须具有“网卡”接口。数据包必须是从一块网卡传送到另一块网卡。网卡的地址，就是数据包的发送地址和接收地址，这叫做MAC地址。

![](/assets/bg2012052905.jpg)

每块网卡出厂的时候，都有一个全世界独一无二的MAC地址，长度是48个二进制位，通常用12个十六进制数来表示，比如：00-B0-D0-86-BB-F7

**广播**：一块网卡怎么会知道另一块网卡的MAC地址呢。这是因为有一种ARP协议（后面会介绍）。以太网采用了一种很原始的方式，它不是把数据包准确的送到接收方，而是向本网络内所有计算机发送，让每台计算机自己判断，是否为接收方。接收方读取数据包的标头，找到接收方的MAC地址，然后与自身MAC地址对比，如果两者相同，则接收这个这个包并做进一步处理，否则丢弃这个包。这种发送方式就叫做“广播”。

**总结：在数据链路层中我们通过MAC地址来识别不同的节点（节点是通过MAC地址来唯一标识的）**

### 2 网络层

理论上，仅依靠MAC地址，上海的网卡就可以找到洛杉矶的网卡，这在技术上是可以实现的。但是，这样做有一个重大的缺点。以太网采用广播方式发送数据包，所有成员人都会受到这个数据包，不仅效率低，而且局限在发送者所在的子网络。也就是说，如果两台计算机不在同一个子网络，广播是传不进去的。这种设计也是合理的，否则互联网上每一台计算机都会收到所有包，那会引起灾难。

因此，必须找到一种方法，能够区分哪些MAC地址属于同一个子网络，哪些不是。如果是同一个子网络，就采用广播方式发送，否则采用“路由”方式发送（路由的意思，就是指如何向不同的子网络分发数据包）。遗憾的是，MAC地址本身无法做到这一点。它只与厂商有关，与所处网络无关。

这就导致了网络层的诞生。它的作用是引进一套新的地址，使得我们能够区分不同的计算机是否属于同一个子网络。这套地址就叫做“网络地址”，简称“网址”。

于是，“网络层”出现后，每台计算机有了两种地址：MAC地址和网络地址。两种地址之间没有任何联系，MAC地址是绑定在网卡上的，网络地址则是管理员分配的，他们只是随机组合在一起。

网络地址帮助我们确定计算机所在的子网络，MAC地址则将数据包送到该子网络中的目标网卡。因此，从逻辑上判断，必定是先处理网络地址，然后再处理MAC地址。

规定网络地址的协议叫做IP协议。它所定义的地址叫做IP地址

目前广泛采用的是IP协议第四版，简称IPv4。这个版本规定，网络地址有32个二进制位组成。习惯上，我们用分成四段的十进制数表示IP地址，从0.0.0.0~255.255.255.255

互联网上的每一台计算机，都会分配到一个IP地址。这个地址分成两个部分，前一部分代表网络，后一部分代表主机，如果两台计算机的前一部分如果相同，则表示它们处于同一个子网络。（后面会介绍IP地址的分类）。

#### 2.1 IP协议

IP协议的主要作用有两个，一是为每台计算机分配IP地址；另一个是确定哪些地址在同一个子网络。

IP数据包：根据IP协议发送的数据，就叫做IP数据包。IP数据包也包含“标头”和“数据”两部分，“标头”部分主要包括版本、长度、IP地址等信息；“数据部分”则是IP数据包的具体内容。

#### 2.2 ARP协议

ARP协议是根据IP地址获取MAC地址的协议。

ARP：Address Resolution Protocol 地址解析协议

因为IP数据是放在以太网数据包里发送的，所以我们必须同时知道两个地址，一个是对方的MAC地址，另一个是对方的IP地址。通常情况下，对方的IP地址是已知的，但是对方的MAC地址是未知的。

所以我们需要一种机制，能够从IP地址得到MAC地址。

这里又可以分为两种情况：

1. 如果两台主机不在同一个子网络，那么事实上没有办法得到对方的MAC地址，只能把数据包传送到两个子网络连接处的“网关”，让网关去处理。
2. 如果两台主机在同一个子网络，那么可以用ARP协议得到对方的MAC地址。使用ARP协议时，会首先检查ARP高速缓存（IP-MAC地址对应表缓存），如果查询的IP-MAC对不存在，那么就发送一个ARP协议广播包。ARP协议也是发出一个数据包（包含在以太网数据包中），其中包含它所要查询主机的IP地址，而在对方的MAC地址一栏，填的是FF:FF:FF:FF:FF:FF，表示这是一个广播地址。它所在的子网络的每一台主机，都会收到这个数据包，从中取出IP地址，与自身IP地址进行比较。如果两者相同，就做出回复，向发送方报告自己的MAC地址，否则丢弃这个包。发送方收到MAC地址后会更新ARP缓存。

#### 2.3 ICMP协议

ICMP：Internet Control Message Protocol **Internet控制报文协议**

IP协议并不是一个可靠的协议，它不能保证数据被送达。当传送IP数据包发生错误，比如主机不可达、路由器不可达等等。ICMP协议会把错误信息封包，然后传回给发送方，通过这些信息，发送方可以对所发生的问题作出诊断，然后采取适当的措施解决。它与传输协议最大的不同：它一般不用于在两点间传输数据，而常常用于返回的错误信息或是分析路由。

**总结：网络层的功能是建立“主机到主机**”**的通信**

### 3 传输层

有了MAC地址和IP地址，我们已经可以在互联网上任意两台主机之间进行通信。接下来的问题是，同一台主机上有许多程序都需要用到网络，比如你一边浏览网页，一边与朋友在线聊天。当一个数据包从互联网上发来的时候，该如何区分是网页内容还是在线聊天内容？

也就是说，我们还需要一个参数，表示这个包到底供哪个程序使用。这个参数就叫做“端口”，它其实是每一个使用网卡程序的编号。每个数据包都发送到主机的特定端口，所以不同的程序就能取到自己所需要的数据。

**端口**：0~65535之间的一个整数，正好16个二进制位。其中0~1023端口被系统占用。

**传输层的作用是建立“端口到端口”的通信。**

#### 3.1 UDP协议

UDP：User Datagram Protocol 用户数据报协议

要在数据包中加入端口信息，就需要新的协议。最简单的实现叫做UDP协议，它的格式几乎就是在数据报前面加上端口号。

UDP数据包，也是由“标头”和“数据”两部分组成。

“标头”部分主要定义了发送端口和接收端口，“数据”部分就是具体的内容。

#### 3.2 TCP协议

TCP：Transmission Control Protocol 传输控制协议

UDP协议的优点是简单、容易实现，缺点是可靠性差，一旦数据包发出，无法知道对方是否已收到。

为了提高网络可靠性，TCP协议就诞生了。TCP协议非常复杂，但可以近似的认为，它就是有确认机制的UDP协议，每发出一个数据包都要求确认。如果有一个数据包丢失，就收不到确认，发送方就知道有必要重发这个数据包。

TCP协议能够确保数据不被丢失，缺点是过程复杂、实现困难、消耗较多资源。

### 4 应用层

TCP协议可以为各式各样的程序传递数据，比如Email、www、FTP等等。那么必须有不同的协议规定电子邮件、网页、FTP数据的格式，这些应用程序协议就构成了应用层。

应用层是最高层，直接面对用户。

应用层的协议有：SMTP（电子邮件）、HTTP（万维网）、TELNET（远程终端连接）、FTP（文件传输）、DNS（域名转换）等等。

## 以上内容摘自：

阮一峰的博客：《互联网协议入门》[http://www.ruanyifeng.com/blog/2012/05/internet\_protocol\_suite\_part\_i.html](http://www.ruanyifeng.com/blog/2012/05/internet_protocol_suite_part_i.html)

[https://github.com/LRH1993/android\_interview/blob/master/computer-networks/tcpip.md](https://github.com/LRH1993/android_interview/blob/master/computer-networks/tcpip.md)

《TCP/IP协议族》第四版

